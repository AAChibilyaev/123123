# PRD: Многоязычная платформа лендинга и документации

## 1. Обзор продукта
Платформа объединяет маркетинговый лендинг и раздел документации в едином Next.js-приложении. Основной контент описывается через DSL-файлы и автоматически транслируется в React-страницы, что упрощает совместную работу контент-менеджеров и разработчиков и обеспечивает консистентность UI-компонентов.

## 2. Цели
- Сократить время вывода новых маркетинговых страниц и документации за счёт генерации из декларативных спецификаций.
- Обеспечить единый визуальный стиль и UX на всех публичных страницах благодаря унифицированным UI-компонентам.
- Поддерживать многоязычность (en/ru) и автоматизировать обновление переводов.
- Снизить технические риски при масштабировании контента за счёт автоматического подключения компонентных зависимостей и проверки схем.

## 3. Целевая аудитория
- **Команда маркетинга**: готовит лендинги и промо-блоки для продуктовых запусков.
- **Технические писатели**: ведут раздел документации и обновляют руководства.
- **Разработчики**: поддерживают UI-компоненты, интеграции с реестрами и автоматизацию сборки.

## 4. Пользовательские сценарии
1. Маркетолог описывает задачу в `pnpm apg:agent`, получает предложенный YAML от AI-агента, подтверждает его и автоматически получает готовую страницу с Hero, списком фич и CTA.
2. Технический писатель обновляет документацию, редактируя YAML и JSON переводы, после чего запускает `apg:extract` для проверки ключей.
3. Разработчик расширяет библиотеку UI-компонентов, добавляя новые карточки или графики, и подключает их к DSL через `@official/*` или кастомные компоненты.
4. Пользователь сайта переключает язык, получая локализованный интерфейс и контент.

## 5. Функциональные требования
### 5.1 Маркетинговый лендинг
- Страница `/` отображает Hero-блок с лоадером, список преимуществ, таблицу данных и группу CTA-кнопок.【F:app/[locale]/'(marketing)'/page.tsx†L1-L35】
- Компоненты Hero, FeatureList, DataTable, ButtonGroup и Spinner должны быть адаптивными и переиспользуемыми.【F:components/ui/hero.tsx†L1-L47】【F:components/ui/feature-list.tsx†L1-L31】【F:components/ui/data-table.tsx†L1-L49】【F:components/ui/button-group.tsx†L1-L46】【F:components/ui/spinner.tsx†L1-L18】

### 5.2 Раздел документации
- Группа маршрутов `/docs` использует отдельный layout и повторно применяет существующие UI-блоки.【F:app/[locale]/(docs)/docs/page.tsx†L1-L24】
- Для каждой страницы генерируются SEO-метаданные (title, description) из DSL.【F:scripts/codegen.ts†L92-L110】【F:dsl-pages/docs-overview.yaml†L1-L17】

### 5.3 DSL и генерация
- Контент страниц описывается в `dsl-pages/*.yaml`, включая layout, динамический режим и блоки с компонентами.【F:dsl-pages/home.yaml†L1-L31】
- Скрипт `pnpm apg:generate` парсит DSL, проверяет наличие компонентов в реестре и генерирует React-страницы в `app/[locale]/*`.【F:scripts/apg-generate.ts†L1-L35】【F:scripts/codegen.ts†L1-L117】
- Недостающие компоненты автоматически подтягиваются через shadcn CLI или генерируются через Vercel v0 при наличии токена.【F:scripts/ensure.ts†L1-L37】
- Структура компонентов описывается схемой Zod и валидируется до генерации.【F:schemas/page.ts†L1-L25】

### 5.4 Локализация
- Приложение поддерживает локали en и ru, определяемые в middleware и layout по сегменту `[locale]` в маршруте.【F:middleware.ts†L1-L4】【F:app/[locale]/layout.tsx†L1-L33】
- Скрипт `pnpm apg:extract` собирает ключи `@i18n.*` из DSL и синхронизирует JSON локалей, чтобы исключить пропуски переводов.【F:scripts/i18n-extract.ts†L1-L55】
- Файлы переводов хранятся в `locales/*.json` и могут дополняться вручную или через внешние сервисы синхронизации.【F:locales/ru.json†L1-L18】

### 5.5 Администрирование и контент-операции
- Скрипт `scripts/generate-dsl.sh` автоматически создаёт заготовки страниц через hygen и запускает генерацию/экстракцию для массового наполнения контентом.【F:scripts/generate-dsl.sh†L1-L9】
- Настройки реестров компонентов и алиасы путей управляются через `components.json` и `tsconfig.json`.

## 6. Нефункциональные требования
- **Производительность**: основные страницы генерируются статически (`force-static`), минимизируя время ответа.【F:app/[locale]/'(marketing)'/page.tsx†L11-L12】
- **Доступность**: UI-компоненты должны поддерживать стандартные ARIA-атрибуты (например, `Spinner` с `role="status"`).【F:components/ui/spinner.tsx†L11-L18】
- **Масштабируемость контента**: добавление новых блоков не требует правок существующих страниц благодаря декларативным DSL и автоматическому подключению импортов.【F:scripts/codegen.ts†L17-L86】
- **SEO**: каждая страница обязана определять `generateMetadata`, формируя title/description на основе переводов.【F:app/[locale]/'(marketing)'/page.tsx†L28-L35】
- **Локализация**: все пользовательские тексты должны быть покрыты ключами `@i18n.*` с fallback на английский.

## 7. Техническая архитектура
- Next.js 14 с React 18, использование middleware для определения локали и server components по умолчанию.【F:middleware.ts†L1-L4】【F:app/[locale]/layout.tsx†L1-L33】
- Tailwind CSS конфигурируется через `tailwind.config.ts` с охватом `app`, `components`, `lib` каталогов.【F:tailwind.config.ts†L1-L7】
- DSL пайплайн: `ingest.ts` читает YAML/JSON/XML, `codegen.ts` формирует JSX, `ensure.ts` гарантирует наличие компонентов, `registry-map.ts` сопоставляет идентификаторы с импортами.【F:scripts/ingest.ts†L1-L15】【F:scripts/codegen.ts†L1-L117】【F:scripts/ensure.ts†L1-L37】【F:scripts/registry-map.ts†L1-L18】
- Локализации подгружаются в layout через `NextIntlClientProvider`, обеспечивая доступ к переводам в серверных компонентах.【F:app/[locale]/layout.tsx†L1-L33】

## 8. Метрики успеха
- Время вывода новой страницы: ≤ 1 день от создания DSL до публикации.
- Покрытие переводов: ≥ 95% ключей без значения `__MISSING__` после запуска `apg:extract`.
- Core Web Vitals на продакшене: LCP < 2.5 c, CLS < 0.1, FID < 100 мс (контролируется через Lighthouse CI).

## 9. Риски и допущения
- Зависимость от внешних реестров shadcn/ui: при недоступности потребуется fallback через Vercel v0 или локальную библиотеку компонентов.
- Консистентность переводов зависит от дисциплины команд: необходимо интегрировать `apg:extract` в CI.
- Расширение количества локалей потребует обновления middleware и генерации статических параметров.
- При изменениях в структуре DSL потребуется синхронизация со схемой Zod и перепроверка генератора.

## 10. План развития
- Добавить визуальный просмотрщик DSL (editor-preview) для контент-команд.
- Расширить библиотеку готовых блоков (карусели, таймлайны, формы подписки).
- Настроить автоматическое деплой-оповещение в Slack при успешной генерации и синхронизации переводов.
- Ввести интеграцию с аналитикой (например, отправка событий в Product Analytics через кастомные хуки).

